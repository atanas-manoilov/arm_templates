{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
      "vaults_dominant_ray_kv_name": {
          "defaultValue": "dominant-ray-kv",
          "type": "String"
      },
      "privateEndpoints_dominant_ray_kv_pe_name": {
          "defaultValue": "dominant-ray-kv-pe",
          "type": "String"
      },
      "privateDnsZones_privatelink_vaultcore_azure_net_name": {
          "defaultValue": "privatelink.vaultcore.azure.net",
          "type": "String"
      },
      "virtualnetworks_dominant_ray_vnet_externalid": {
          "defaultValue": "/subscriptions/28f02a8b-306a-4c98-a425-14a6725747a6/resourceGroups/proud-lemur-vnet-rg/providers/microsoft.network/virtualnetworks/dominant-ray-vnet",
          "type": "String"
      }
  },
  "variables": {},
  "resources": [
      {
          "type": "Microsoft.KeyVault/vaults",
          "apiVersion": "2024-04-01-preview",
          "name": "[parameters('vaults_dominant_ray_kv_name')]",
          "location": "westus2",
          "tags": {
              "environment": "Development"
          },
          "properties": {
              "sku": {
                  "family": "A",
                  "name": "standard"
              },
              "tenantId": "830c9ea6-1c8e-411c-8bf0-f519b37fd808",
              "networkAcls": {
                  "bypass": "None",
                  "defaultAction": "Deny",
                  "ipRules": [
                      {
                          "value": "89.102.176.88/32"
                      }
                  ],
                  "virtualNetworkRules": [
                      {
                          "id": "[concat(parameters('virtualnetworks_dominant_ray_vnet_externalid'), '/subnets/private-endpoint-subnet')]"
                      }
                  ]
              },
              "accessPolicies": [
                  {
                      "tenantId": "830c9ea6-1c8e-411c-8bf0-f519b37fd808",
                      "objectId": "ad610c8c-da89-4b6b-b31d-c09d6ba7d9e3",
                      "permissions": {
                          "certificates": [
                              "Get",
                              "List",
                              "Import"
                          ],
                          "keys": [
                              "Get",
                              "List"
                          ],
                          "secrets": [
                              "Get",
                              "List"
                          ],
                          "storage": []
                      }
                  },
                  {
                      "tenantId": "830c9ea6-1c8e-411c-8bf0-f519b37fd808",
                      "objectId": "bcd881d3-1596-487e-9a4e-babdb6b2add0",
                      "permissions": {
                          "certificates": [
                              "Get",
                              "List",
                              "Import"
                          ],
                          "keys": [
                              "Get",
                              "List"
                          ],
                          "secrets": [
                              "Get",
                              "List"
                          ],
                          "storage": []
                      }
                  },
                  {
                      "tenantId": "830c9ea6-1c8e-411c-8bf0-f519b37fd808",
                      "objectId": "14453a6e-2e54-4f25-9c10-d17bfd9e918d",
                      "permissions": {
                          "certificates": [
                              "Get",
                              "List",
                              "Import"
                          ],
                          "keys": [
                              "Get",
                              "List"
                          ],
                          "secrets": [
                              "Get",
                              "List"
                          ],
                          "storage": []
                      }
                  },
                  {
                      "tenantId": "830c9ea6-1c8e-411c-8bf0-f519b37fd808",
                      "objectId": "ea351e19-3390-4d98-9ea2-fd66abce3bf1",
                      "permissions": {
                          "certificates": [
                              "Get",
                              "List",
                              "Import"
                          ],
                          "keys": [
                              "Get",
                              "List"
                          ],
                          "secrets": [
                              "Get",
                              "List"
                          ],
                          "storage": []
                      }
                  }
              ],
              "enabledForDeployment": false,
              "enabledForDiskEncryption": false,
              "enabledForTemplateDeployment": false,
              "enableSoftDelete": true,
              "enableRbacAuthorization": false,
              "enablePurgeProtection": true,
              "vaultUri": "[concat('https://', parameters('vaults_dominant_ray_kv_name'), '.vault.azure.net/')]",
              "provisioningState": "Succeeded",
              "publicNetworkAccess": "Enabled"
          }
      },
      {
          "type": "Microsoft.Network/privateDnsZones",
          "apiVersion": "2024-06-01",
          "name": "[parameters('privateDnsZones_privatelink_vaultcore_azure_net_name')]",
          "location": "global",
          "properties": {}
      },
      {
          "type": "Microsoft.KeyVault/vaults/privateEndpointConnections",
          "apiVersion": "2024-04-01-preview",
          "name": "[concat(parameters('vaults_dominant_ray_kv_name'), '/', parameters('vaults_dominant_ray_kv_name'), '-connection')]",
          "location": "westus2",
          "dependsOn": [
              "[resourceId('Microsoft.KeyVault/vaults', parameters('vaults_dominant_ray_kv_name'))]"
          ],
          "properties": {
              "provisioningState": "Succeeded",
              "privateEndpoint": {},
              "privateLinkServiceConnectionState": {
                  "status": "Approved",
                  "actionsRequired": "None"
              }
          }
      },
      {
          "type": "Microsoft.KeyVault/vaults/secrets",
          "apiVersion": "2024-04-01-preview",
          "name": "[concat(parameters('vaults_dominant_ray_kv_name'), '/my-ssl-cert')]",
          "location": "westus2",
          "dependsOn": [
              "[resourceId('Microsoft.KeyVault/vaults', parameters('vaults_dominant_ray_kv_name'))]"
          ],
          "properties": {
              "contentType": "application/x-pkcs12",
              "attributes": {
                  "enabled": true,
                  "nbf": 1730900377,
                  "exp": 1738676376
              }
          }
      },
      {
          "type": "Microsoft.Network/privateDnsZones/A",
          "apiVersion": "2024-06-01",
          "name": "[concat(parameters('privateDnsZones_privatelink_vaultcore_azure_net_name'), '/dominant-ray-kv')]",
          "dependsOn": [
              "[resourceId('Microsoft.Network/privateDnsZones', parameters('privateDnsZones_privatelink_vaultcore_azure_net_name'))]"
          ],
          "properties": {
              "metadata": {
                  "creator": "created by private endpoint dominant-ray-kv-pe with resource guid 491507fe-43b0-4950-b68f-d6bb725e19e8"
              },
              "ttl": 10,
              "aRecords": [
                  {
                      "ipv4Address": "10.0.3.4"
                  }
              ]
          }
      },
      {
          "type": "Microsoft.Network/privateDnsZones/SOA",
          "apiVersion": "2024-06-01",
          "name": "[concat(parameters('privateDnsZones_privatelink_vaultcore_azure_net_name'), '/@')]",
          "dependsOn": [
              "[resourceId('Microsoft.Network/privateDnsZones', parameters('privateDnsZones_privatelink_vaultcore_azure_net_name'))]"
          ],
          "properties": {
              "ttl": 3600,
              "soaRecord": {
                  "email": "azureprivatedns-host.microsoft.com",
                  "expireTime": 2419200,
                  "host": "azureprivatedns.net",
                  "minimumTtl": 10,
                  "refreshTime": 3600,
                  "retryTime": 300,
                  "serialNumber": 1
              }
          }
      },
      {
          "type": "Microsoft.Network/privateDnsZones/virtualNetworkLinks",
          "apiVersion": "2024-06-01",
          "name": "[concat(parameters('privateDnsZones_privatelink_vaultcore_azure_net_name'), '/dominant-ray-kv-dnslink')]",
          "location": "global",
          "dependsOn": [
              "[resourceId('Microsoft.Network/privateDnsZones', parameters('privateDnsZones_privatelink_vaultcore_azure_net_name'))]"
          ],
          "properties": {
              "registrationEnabled": false,
              "resolutionPolicy": "Default",
              "virtualNetwork": {
                  "id": "[parameters('virtualnetworks_dominant_ray_vnet_externalid')]"
              }
          }
      },
      {
          "type": "Microsoft.Network/privateEndpoints",
          "apiVersion": "2024-01-01",
          "name": "[parameters('privateEndpoints_dominant_ray_kv_pe_name')]",
          "location": "westus2",
          "dependsOn": [
              "[resourceId('Microsoft.KeyVault/vaults', parameters('vaults_dominant_ray_kv_name'))]"
          ],
          "properties": {
              "privateLinkServiceConnections": [
                  {
                      "name": "dominant-ray-kv-connection",
                      "id": "[concat(resourceId('Microsoft.Network/privateEndpoints', parameters('privateEndpoints_dominant_ray_kv_pe_name')), '/privateLinkServiceConnections/dominant-ray-kv-connection')]",
                      "properties": {
                          "privateLinkServiceId": "[resourceId('Microsoft.KeyVault/vaults', parameters('vaults_dominant_ray_kv_name'))]",
                          "groupIds": [
                              "vault"
                          ],
                          "privateLinkServiceConnectionState": {
                              "status": "Approved",
                              "actionsRequired": "None"
                          }
                      }
                  }
              ],
              "manualPrivateLinkServiceConnections": [],
              "subnet": {
                  "id": "[concat(parameters('virtualnetworks_dominant_ray_vnet_externalid'), '/subnets/private-endpoint-subnet')]"
              },
              "ipConfigurations": [],
              "customDnsConfigs": []
          }
      },
      {
          "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
          "apiVersion": "2024-01-01",
          "name": "[concat(parameters('privateEndpoints_dominant_ray_kv_pe_name'), '/keyvault-dns-zone-group')]",
          "dependsOn": [
              "[resourceId('Microsoft.Network/privateEndpoints', parameters('privateEndpoints_dominant_ray_kv_pe_name'))]",
              "[resourceId('Microsoft.Network/privateDnsZones', parameters('privateDnsZones_privatelink_vaultcore_azure_net_name'))]"
          ],
          "properties": {
              "privateDnsZoneConfigs": [
                  {
                      "name": "privatelink.vaultcore.azure.net",
                      "properties": {
                          "privateDnsZoneId": "[resourceId('Microsoft.Network/privateDnsZones', parameters('privateDnsZones_privatelink_vaultcore_azure_net_name'))]"
                      }
                  }
              ]
          }
      }
  ]
}